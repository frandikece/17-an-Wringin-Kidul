<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lomba 17-an 2025</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Rubik&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(to bottom, #fce4ec, #ffffff);
      font-family: 'Rubik', sans-serif;
    }
    header {
      position: relative;
      background-color: #b71c1c;
      color: white;
      padding: 4rem 1rem;
      text-align: center;
      overflow: hidden;
    }
    header h1 {
      font-family: 'Fredoka One', cursive;
      font-size: 3.2rem;
      z-index: 2;
      position: relative;
    }
    .ball {
      position: absolute;
      border-radius: 50%;
      opacity: 0.25;
      animation: float 10s infinite ease-in-out;
    }
    @keyframes float {
      0% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-50px) rotate(180deg); }
      100% { transform: translateY(0) rotate(360deg); }
    }
    .ball { width: 50px; height: 50px; background: #ff5252; }
    .ball:nth-child(1) { top: 10%; left: 5%; }
    .ball:nth-child(2) { top: 20%; left: 15%; background: #ffc107; }
    .ball:nth-child(3) { top: 30%; left: 80%; background: #4caf50; }
    .ball:nth-child(4) { top: 40%; left: 25%; background: #2196f3; }
    .ball:nth-child(5) { top: 50%; left: 60%; background: #9c27b0; }
    .ball:nth-child(6) { top: 15%; left: 40%; background: #ff5722; }
    .ball:nth-child(7) { top: 65%; left: 10%; background: #3f51b5; }
    .ball:nth-child(8) { top: 70%; left: 30%; background: #009688; }
    .ball:nth-child(9) { top: 35%; left: 70%; background: #cddc39; }
    .ball:nth-child(10) { top: 25%; left: 85%; background: #795548; }
    .ball:nth-child(11) { top: 45%; left: 50%; background: #e91e63; }
    .ball:nth-child(12) { top: 5%; left: 75%; background: #607d8b; }

    .btn-cta {
      background-color: #ffffff;
      color: #b71c1c;
      border: 3px solid #b71c1c;
      font-weight: bold;
      border-radius: 50px;
      padding: 0.6rem 1.5rem;
      transition: 0.3s ease;
      z-index: 2;
      position: relative;
    }
    .btn-cta:hover {
      background-color: #b71c1c;
      color: white;
    }
    main h2 {
      font-family: 'Fredoka One', cursive;
      color: #bf360c;
    }
    .filter-buttons {
      text-align: center;
      margin-bottom: 2rem;
    }
    .filter-buttons .btn {
      margin: 0.2rem;
    }
    .card {
      border: none;
      border-radius: 16px;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }
    .card-title {
      font-weight: bold;
      color: #d84315;
    }
    .badge-merah, .badge {
      background-color: #ff7043 !important;
    }
    .footer {
      background: linear-gradient(to right, #c62828, #b71c1c);
      color: white;
      padding: 1rem;
      text-align: center;
      margin-top: 3rem;
      font-size: 0.9rem;
    }
    .admin-login-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 0.8rem;
      padding: 0.3rem 0.6rem;
    }
      @media (max-width: 768px) {
      header h1 {
        font-size: 2rem;
      }
      .btn-cta {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
      }
      .filter-buttons .btn {
        display: block;
        width: 100%;
        margin: 0.3rem 0;
      }
      .card-title {
        font-size: 1.1rem;
      }
      .modal-content {
        font-size: 0.9rem;
      }
      .table {
        font-size: 0.9rem;
      }
      .admin-login-btn {
        top: 0.5rem;
        right: 0.5rem;
        font-size: 0.7rem;
        padding: 0.2rem 0.4rem;
      }
    }
  </style>
<style>
  .text-gold {
    color: #ff9800;
    font-weight: bold;
    text-shadow: 1px 1px 4px rgba(0,0,0,0.2);
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
  <header>
    <div class="ball"></div><div class="ball"></div><div class="ball"></div><div class="ball"></div><div class="ball"></div><div class="ball"></div><div class="ball"></div><div class="ball"></div><div class="ball"></div><div class="ball"></div><div class="ball"></div><div class="ball"></div>
    <button class="btn btn-light btn-sm admin-login-btn" onclick="showAdminLoginModal()">Login Admin</button>
    <h1>Ayo Meriahkan Lomba 17-an 2025!</h1>
    <p class="lead">Cek jadwal, lokasi, dan jenis perlombaan di lingkungan kita.</p>
    <a href="#lomba" class="btn btn-cta mt-3 shadow">Lihat Jadwal Lomba</a>
  </header>

<main class="container py-5" id="lomba">
    <h2 class="text-center mb-4">Daftar Perlombaan Seru</h2>
    <div class="row mb-4">
      <div class="col-md-6 offset-md-3">
        <div class="input-group">
          <label class="input-group-text" for="sortOrder">Urutkan Tanggal:</label>
          <select class="form-select" id="sortOrder" onchange="sortLomba(this.value)">
            <option value="asc">Terlama ke Terbaru</option>
            <option value="desc">Terbaru ke Terlama</option>
          </select>
        </div>
      </div>
    </div>
    <div class="filter-buttons">
      <button class="btn btn-outline-danger" onclick="filterKategori('Campuran Warga')">Campuran Warga</button>
      <button class="btn btn-outline-danger" onclick="filterKategori('SD, SMP-SMA')">SD, SMP-SMA</button>
      <button class="btn btn-outline-danger" onclick="filterKategori('PAUD - SD kelas 3')">PAUD - SD kelas 3</button>
      <button class="btn btn-outline-danger" onclick="filterKategori('TK - SD kelas 3, SD kelas 4 - SMP')">TK - SD, SMP</button>
      <button class="btn btn-outline-danger" onclick="filterKategori('Ibu-ibu')">Ibu-ibu</button>
      <button class="btn btn-outline-secondary" onclick="filterKategori('all')">Tampilkan Semua</button>
    </div>
    <div class="row g-4" id="daftarLomba"></div>
  <div id="pemenangModal" class="modal fade" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center bg-light border-warning border-4">
      <div class="modal-header bg-warning text-white">
        <h5 class="modal-title w-100" id="judulPemenang">üèÜ Pemenang</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <h3 class="text-gold">ü•á Juara 1</h3>
        <p id="juara1" class="fs-5 fw-bold"></p>
        <h4>ü•à Juara 2</h4>
        <p id="juara2"></p>
        <h5>ü•â Juara 3</h5>
        <p id="juara3"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
      </div>
    </div>
  </div>
</div>
</main>

<section class="container py-5" id="leaderboard">
  <h2 class="text-center mb-4" style="color: gold; text-shadow: 1px 1px 3px #555">üèÖ Leaderboard Pemenang Terbanyak</h2>
  <div class="table-responsive">
    <table class="table table-bordered text-center" style="border-color: gold">
      <thead style="background-color: gold; color: #000">
        <tr>
          <th>Peringkat</th>
          <th>Nama Peserta</th>
          <th>Jumlah Menang</th>
        </tr>
      </thead>
      <tbody id="leaderboardBody">
        <!-- Diisi dengan JS -->
      </tbody>
    </table>
  </div>
</section>

<section class="container py-5" id="rundown">
  <h2 class="text-center mb-4">üóìÔ∏è Jadwal Lomba 17-an</h2>
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead class="table-danger text-center">
        <tr>
          <th>Tanggal</th>
          <th>Jam</th>
          <th>Acara/Lomba</th>
          <th>Kategori Peserta</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td rowspan="5">Sabtu, 2 Agustus 2025</td>
          <td rowspan="5">08.00 - selesai</td>
          <td>Memasukkan Pensil</td>
          <td>TK - SD kelas 3, SD kelas 4 - SMP</td>
        </tr>
        <tr>
          <td>Mewarnai</td>
          <td>PAUD - SD kelas 3</td>
        </tr>
        <tr>
          <td>CCA (Cerdas Cermat Agama)</td>
          <td>SD kelas 4 - SMA</td>
        </tr>
        <tr>
          <td>Lari Kelereng</td>
          <td>SD, SMP-SMA</td>
        </tr>
        <tr>
          <td>Lari Bendera</td>
          <td>SD kelas 3</td>
        </tr>
        <tr>
          <td rowspan="6">Sabtu, 9 Agustus 2025</td>
          <td rowspan="6">08.00 - selesai</td>
          <td>Joget Balon</td>
          <td>Ibu-ibu</td>
        </tr>
        <tr>
          <td>Estafet Sarung</td>
          <td>Ibu-ibu</td>
        </tr>
        <tr>
          <td>Balap Karung</td>
          <td>SD, SMP-SMA</td>
        </tr>
        <tr>
          <td>Pecah Air</td>
          <td>TK - SD kelas 3, SD kelas 4 - SMP</td>
        </tr>
        <tr>
          <td>Estafet Tepung</td>
          <td>SD kelas 4 - SMA</td>
        </tr>
        <tr>
          <td>Estafet Air</td>
          <td>SD kelas 4 - SMA</td>
        </tr>
        <tr>
          <td>Minggu, 10 Agustus 2025</td>
          <td>08.00 - selesai</td>
          <td>Volly Campuran</td>
          <td>Campuran Warga</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<!-- Bagian baru untuk Foto 17-an -->
<section class="container py-5 text-center" id="galeri-foto">
  <h2 class="mb-4">üì∏ Galeri Foto 17-an</h2>
  <p class="lead">Lihat keseruan momen-momen lomba dan acara 17-an tahun ini di Instagram kami!</p>
  <a href="https://www.instagram.com/kanoman_mandira?igsh=MWw5aXFkdTZrZmNjdw==" target="_blank" class="btn btn-danger btn-lg mt-3 shadow-lg">
    Lihat di Instagram
  </a>
</section>

<footer class="footer">
    Website ini dibuat untuk membantu masyarakat mengetahui informasi lomba 17-an 2025.<br>
    Hubungi panitia RT untuk info lebih lanjut. Semangat Merdeka! üáÆüá©
  </footer>

  <!-- Admin Login Modal -->
<div class="modal fade" id="adminLoginModal" tabindex="-1" aria-labelledby="adminLoginModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="adminLoginModalLabel">Login Admin</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="adminUsername" class="form-label">Username</label>
          <input type="text" class="form-control" id="adminUsername">
        </div>
        <div class="mb-3">
          <label for="adminPassword" class="form-label">Password</label>
          <input type="password" class="form-control" id="adminPassword">
        </div>
        <div id="loginMessage" class="text-danger"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
        <button type="button" class="btn btn-primary" onclick="performAdminLogin()">Login</button>
      </div>
    </div>
  </div>
</div>

<!-- Admin Panel Modal -->
<div class="modal fade" id="adminPanelModal" tabindex="-1" aria-labelledby="adminPanelModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="adminPanelModalLabel">Panel Admin</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h4>Edit Lomba</h4>
        <select class="form-select mb-3" id="editLombaSelect" onchange="loadLombaForEdit()">
          <option value="">Pilih Lomba</option>
        </select>
        <div id="lombaEditForm" style="display: none;">
          <input type="hidden" id="editLombaIndex">
          <div class="mb-3">
            <label for="editLombaNama" class="form-label">Nama Lomba</label>
            <input type="text" class="form-control" id="editLombaNama">
          </div>
          <div class="mb-3">
            <label for="editLombaKategori" class="form-label">Kategori</label>
            <input type="text" class="form-control" id="editLombaKategori">
          </div>
          <div class="mb-3">
            <label for="editLombaLokasi" class="form-label">Lokasi</label>
            <input type="text" class="form-control" id="editLombaLokasi">
          </div>
          <div class="mb-3">
            <label for="editLombaTanggal" class="form-label">Tanggal</label>
            <input type="text" class="form-control" id="editLombaTanggal" placeholder="Contoh: 2 Agustus 2025">
          </div>
          <div class="mb-3">
            <label for="editLombaKonsep" class="form-label">Konsep</label>
            <textarea class="form-control" id="editLombaKonsep" rows="3"></textarea>
          </div>
          <button class="btn btn-success" onclick="saveLombaChanges()">Simpan Perubahan Lomba</button>
        </div>

        <h4 class="mt-4">Edit Pemenang Lomba</h4>
        <select class="form-select mb-3" id="editPemenangSelect" onchange="loadPemenangForEdit()">
          <option value="">Pilih Lomba untuk Edit Pemenang</option>
        </select>
        <div id="pemenangEditForm" style="display: none;">
          <input type="hidden" id="editPemenangLombaIndex">
          <div class="mb-3">
            <label for="editJuara1" class="form-label">Juara 1</label>
            <input type="text" class="form-control" id="editJuara1">
          </div>
          <div class="mb-3">
            <label for="editJuara2" class="form-label">Juara 2</label>
            <input type="text" class="form-control" id="editJuara2">
          </div>
          <div class="mb-3">
            <label for="editJuara3" class="form-label">Juara 3</label>
            <input type="text" class="form-control" id="editJuara3">
          </div>
          <button class="btn btn-success" onclick="savePemenangChanges()">Simpan Perubahan Pemenang</button>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
      </div>
    </div>
  </div>
</div>


  <script type="module">
    // Firebase SDK Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, getDocs, doc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Global variables provided by Canvas environment
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    console.log("App ID yang digunakan:", appId); // LOGGING APP ID

    // Firebase configuration provided by the user
    const firebaseConfig = {
      apiKey: "AIzaSyDay2LcG9AVatBFR9oLR5zr5jQAz8UJTT4",
      authDomain: "website-17-an-wringin-kidul.firebaseapp.com", // PASTIKAN INI BENAR
      projectId: "website-17-an-wringin-kidul",
      storageBucket: "website-17-an-wringin-kidul.firebasestorage.app",
      messagingSenderId: "720251123371",
      appId: "1:720251123371:web:49e07b31156ad2a66fe9ee",
      measurementId: "G-JJRVH8879P"
    };
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

    // Inisialisasi Firebase
    let app;
    let db;
    let auth;
    let userId;

    // Data lomba (akan diisi dari Firestore, ini sebagai fallback/initial data)
    let lombaData = [
      { id: 'lomba1', nama: "Memasukkan Pensil", kategori: "TK - SD kelas 3, SD kelas 4 - SMP", lokasi: "Lapangan Voli", tanggal: "2 Agustus 2025", konsep: "Sama seperti tahun sebelumnya", pemenang: {juara1: 'Budi', juara2: 'Santi', juara3: 'Agus'} },
      { id: 'lomba2', nama: "Mewarnai", kategori: "PAUD - SD kelas 3", lokasi: "Rumah Bpk Purwanto", tanggal: "2 Agustus 2025", konsep: "Gambar dari Kak Siska", pemenang: {juara1: 'Citra', juara2: 'Dedi', juara3: 'Eka'} },
      { id: 'lomba3', nama: "CCA (Cerdas Cermat Agama)", kategori: "SD kelas 4 - SMA", lokasi: "Rumah Bpk Purwanto", tanggal: "2 Agustus 2025", konsep: "Wajib bersuara saat menjawab", pemenang: {juara1: 'Fajar', juara2: 'Gita', juara3: 'Hadi'} },
      { id: 'lomba4', nama: "Lari Kelereng", kategori: "SD, SMP-SMA", lokasi: "Lapangan Voli", tanggal: "2 Agustus 2025", konsep: "Sama seperti tahun sebelumnya", pemenang: {juara1: 'Indra', juara2: 'Joko', juara3: 'Kartika'} },
      { id: 'lomba5', nama: "Lari Bendera", kategori: "SD kelas 3", lokasi: "Lapangan Voli", tanggal: "2 Agustus 2025", konsep: "Sama seperti tahun sebelumnya", pemenang: {juara1: 'Lina', juara2: 'Mira', juara3: 'Nia'} },
      { id: 'lomba6', nama: "Joget Balon", kategori: "Ibu-ibu", lokasi: "Lapangan Voli", tanggal: "9 Agustus 2025", konsep: "Sama seperti tahun sebelumnya", pemenang: {juara1: 'Bu Ani', juara2: 'Bu Beta', juara3: 'Bu Citra'} },
      { id: 'lomba7', nama: "Estafet Sarung", kategori: "Ibu-ibu", lokasi: "Lapangan Voli", tanggal: "9 Agustus 2025", konsep: "Sama seperti tahun sebelumnya", pemenang: {juara1: 'Bu Dewi', juara2: 'Bu Ela', juara3: 'Bu Fani'} },
      { id: 'lomba8', nama: "Balap Karung", kategori: "SD, SMP-SMA", lokasi: "Lapangan Voli", tanggal: "9 Agustus 2025", konsep: "Sama seperti tahun sebelumnya", pemenang: {juara1: 'Gilang', juara2: 'Hasan', juara3: 'Irfan'} },
      { id: 'lomba9', nama: "Pecah Air", kategori: "TK - SD kelas 3, SD kelas 4 - SMP", lokasi: "Lapangan Voli", tanggal: "9 Agustus 2025", konsep: "Sama seperti tahun sebelumnya", pemenang: {juara1: 'Jihan', juara2: 'Kevin', juara3: 'Laras'} },
      { id: 'lomba10', nama: "Estafet Tepung", kategori: "SD kelas 4 - SMA", lokasi: "Lapangan Voli", tanggal: "9 Agustus 2025", konsep: "Menggunakan kartu remi", pemenang: {juara1: 'Maya', juara2: 'Nanda', juara3: 'Oscar'} },
      { id: 'lomba11', nama: "Estafet Air", kategori: "SD kelas 4 - SMA", lokasi: "Lapangan Voli", tanggal: "9 Agustus 2025", konsep: "Gelas plastik ditali di atas kepala", pemenang: {juara1: 'Putri', juara2: 'Rian', juara3: 'Sinta'} },
      { id: 'lomba12', nama: "Volly Campuran", kategori: "Campuran Warga", lokasi: "Lapangan Voli", tanggal: "10 Agustus 2025", konsep: "4 Tim warga, sistem gugur, semifinal dan final, max 2 orang per KK", pemenang: {juara1: 'Tim A', juara2: 'Tim B', juara3: 'Tim C'} }
    ];

    const container = document.getElementById('daftarLomba');
    let currentFilteredData = [...lombaData]; // Menyimpan data yang sedang difilter

    // Fungsi untuk mengonversi string tanggal menjadi objek Date untuk mempermudah pengurutan
    function parseLombaDates(data) {
        data.forEach(lomba => {
            const dateString = lomba.tanggal.replace('Agustus', 'August');
            lomba.dateObject = new Date(dateString);
        });
        return data;
    }

    // Fungsi untuk merender daftar lomba
    function renderLomba(data) {
      container.innerHTML = '';
      if (data.length === 0) {
          container.innerHTML = '<p class="text-center text-muted">Tidak ada lomba yang ditemukan.</p>';
          return;
      }
      data.forEach(lomba => {
        container.innerHTML += `
          <div class="col-md-6 col-lg-4">
            <div class="card h-100 p-3 bg-white">
              <div class="card-body">
                <h5 class="card-title">${lomba.nama}</h5>
                <span class="badge badge-merah mb-2">${lomba.kategori}</span>
                <p><strong>üìç Lokasi:</strong> ${lomba.lokasi}</p>
                <p><strong>üìÖ Tanggal:</strong> ${lomba.tanggal}</p>
                <p><strong>üìã Konsep:</strong> ${lomba.konsep}</p>
                <div class="d-flex justify-content-start mt-3">
                  <button class="btn btn-warning" onclick="showPemenang('${lomba.nama}')">üéâ Lihat Pemenang</button>
                </div>
              </div>
            </div>
          </div>
        `;
      });
    }

    // Fungsi untuk memfilter lomba berdasarkan kategori
    function filterKategori(kategori) {
      if (kategori === 'all') {
        currentFilteredData = [...lombaData];
      } else {
        currentFilteredData = lombaData.filter(l => l.kategori === kategori);
      }
      const currentSortOrder = document.getElementById('sortOrder').value;
      sortLomba(currentSortOrder, currentFilteredData);
    }

    // Fungsi untuk mengurutkan lomba berdasarkan tanggal
    function sortLomba(order, dataToSort = currentFilteredData) {
        if (order === 'asc') {
            dataToSort.sort((a, b) => a.dateObject - b.dateObject);
        } else { // desc
            dataToSort.sort((a, b) => b.dateObject - a.dateObject);
        }
        renderLomba(dataToSort);
    }

    // Fungsi untuk menampilkan modal pemenang
    function showPemenang(namaLomba) {
      console.log("Mencari lomba:", namaLomba); // LOGGING: Nama lomba yang dicari
      const lomba = lombaData.find(l => l.nama === namaLomba);
      console.log("Lomba ditemukan:", lomba); // LOGGING: Objek lomba yang ditemukan (atau undefined)

      const modal = new bootstrap.Modal(document.getElementById('pemenangModal'));
      document.getElementById('judulPemenang').innerText = `üèÜ Pemenang ${lomba ? lomba.nama : namaLomba}`;

      if (lomba && lomba.pemenang) {
        document.getElementById('juara1').innerText = lomba.pemenang.juara1 || 'Belum ada';
        document.getElementById('juara2').innerText = lomba.pemenang.juara2 || 'Belum ada';
        document.getElementById('juara3').innerText = lomba.pemenang.juara3 || 'Belum ada';
      } else {
        document.getElementById('juara1').innerText = 'Belum ada';
        document.getElementById('juara2').innerText = 'Belum ada';
        document.getElementById('juara3').innerText = 'Belum ada';
      }

      confetti({
        particleCount: 200,
        spread: 100,
        origin: { y: 0.6 }
      });
      document.getElementById('clapAudio').play();
      modal.show();
    }

    // Fungsi untuk mengisi leaderboard
    function populateLeaderboard() {
        const leaderboardBody = document.getElementById('leaderboardBody');
        leaderboardBody.innerHTML = ''; // Bersihkan dulu

        // Hitung kemenangan dari lombaData yang sudah ada pemenangnya
        const winnerCounts = {};
        lombaData.forEach(lomba => {
            if (lomba.pemenang && lomba.pemenang.juara1) {
                winnerCounts[lomba.pemenang.juara1] = (winnerCounts[lomba.pemenang.juara1] || 0) + 1;
            }
            // Anda bisa menambahkan logika untuk juara 2 dan 3 jika ingin mereka juga berkontribusi pada leaderboard
        });

        const dynamicLeaderboardData = Object.keys(winnerCounts)
            .map(name => ({ nama: name, menang: winnerCounts[name] }))
            .sort((a, b) => b.menang - a.menang); // Urutkan dari yang terbanyak menang

        if (dynamicLeaderboardData.length === 0) {
            leaderboardBody.innerHTML = '<tr><td colspan="3" class="text-muted">Belum ada data leaderboard.</td></tr>';
            return;
        }

        dynamicLeaderboardData.forEach((p, i) => {
            leaderboardBody.innerHTML += `
                <tr>
                    <td><strong>${i + 1}</strong></td>
                    <td>${p.nama}</td>
                    <td>${p.menang}</td>
                </tr>
            `;
        });
    }

    const clapAudio = document.getElementById('clapAudio');
    window.addEventListener('load', () => {
        if (clapAudio) {
            clapAudio.load();
        }
    });

    // --- Fitur Admin Login dan Edit ---
    let isAdminLoggedIn = false; // Flag status login admin

    function showAdminLoginModal() {
      const adminLoginModal = new bootstrap.Modal(document.getElementById('adminLoginModal'));
      document.getElementById('adminUsername').value = '';
      document.getElementById('adminPassword').value = '';
      document.getElementById('loginMessage').innerText = '';
      adminLoginModal.show();
    }

    async function performAdminLogin() {
      const username = document.getElementById('adminUsername').value;
      const password = document.getElementById('adminPassword').value;
      const loginMessage = document.getElementById('loginMessage');

      // Kredensial login dummy (ganti dengan autentikasi yang aman di produksi)
      if (username === 'admin' && password === 'admin123') {
        isAdminLoggedIn = true;
        loginMessage.innerText = '';
        const adminLoginModal = bootstrap.Modal.getInstance(document.getElementById('adminLoginModal'));
        adminLoginModal.hide();
        showAdminPanel();
      } else {
        loginMessage.innerText = 'Username atau password salah.';
      }
    }

    function showAdminPanel() {
      if (!isAdminLoggedIn) {
        showAdminLoginModal();
        return;
      }
      const adminPanelModal = new bootstrap.Modal(document.getElementById('adminPanelModal'));
      populateAdminLombaSelect();
      populateAdminPemenangSelect();
      adminPanelModal.show();
    }

    function populateAdminLombaSelect() {
      const select = document.getElementById('editLombaSelect');
      select.innerHTML = '<option value="">Pilih Lomba</option>';
      lombaData.forEach((lomba, index) => {
        const option = document.createElement('option');
        option.value = index; // Menggunakan indeks array untuk saat ini
        option.innerText = lomba.nama;
        select.appendChild(option);
      });
      document.getElementById('lombaEditForm').style.display = 'none';
    }

    function loadLombaForEdit() {
      const select = document.getElementById('editLombaSelect');
      const index = select.value;
      const form = document.getElementById('lombaEditForm');

      if (index === "") {
        form.style.display = 'none';
        return;
      }

      form.style.display = 'block';
      const lomba = lombaData[parseInt(index)];
      document.getElementById('editLombaIndex').value = index;
      document.getElementById('editLombaNama').value = lomba.nama;
      document.getElementById('editLombaKategori').value = lomba.kategori;
      document.getElementById('editLombaLokasi').value = lomba.lokasi;
      document.getElementById('editLombaTanggal').value = lomba.tanggal;
      document.getElementById('editLombaKonsep').value = lomba.konsep;
    }

    async function saveLombaChanges() {
      const index = parseInt(document.getElementById('editLombaIndex').value);
      if (isNaN(index) || index < 0 || index >= lombaData.length) {
        console.error("Indeks lomba tidak valid.");
        return;
      }

      const updatedLomba = {
          ...lombaData[index], // Salin data yang ada
          nama: document.getElementById('editLombaNama').value,
          kategori: document.getElementById('editLombaKategori').value,
          lokasi: document.getElementById('editLombaLokasi').value,
          tanggal: document.getElementById('editLombaTanggal').value,
          konsep: document.getElementById('editLombaKonsep').value
      };

      // Perbarui dateObject setelah mengubah string tanggal
      updatedLomba.dateObject = parseLombaDates([updatedLomba])[0].dateObject;

      // Update data lokal
      lombaData[index] = updatedLomba;

      try {
          // Hapus dateObject sebelum menyimpan karena Date object tidak bisa langsung disimpan di Firestore
          const { dateObject, ...lombaToSave } = updatedLomba;
          await setDoc(doc(db, `artifacts/${appId}/public/data/lomba`, lombaToSave.id), lombaToSave);
          alert("Perubahan lomba berhasil disimpan secara permanen!");
      } catch (error) {
          console.error("Error saving lomba changes to Firestore:", error);
          alert("Gagal menyimpan perubahan lomba ke database. Cek konsol untuk detail.");
      }

      renderLomba(currentFilteredData); // Render ulang daftar yang ditampilkan
      populateAdminLombaSelect(); // Perbarui dropdown pilihan lomba
    }

    function populateAdminPemenangSelect() {
      const select = document.getElementById('editPemenangSelect');
      select.innerHTML = '<option value="">Pilih Lomba untuk Edit Pemenang</option>';
      lombaData.forEach((lomba, index) => {
        const option = document.createElement('option');
        option.value = index; // Menggunakan indeks array untuk saat ini
        option.innerText = lomba.nama;
        select.appendChild(option);
      });
      document.getElementById('pemenangEditForm').style.display = 'none';
    }

    function loadPemenangForEdit() {
      const select = document.getElementById('editPemenangSelect');
      const index = select.value;
      const form = document.getElementById('pemenangEditForm');

      if (index === "") {
        form.style.display = 'none';
        return;
      }

      form.style.display = 'block';
      const lomba = lombaData[parseInt(index)];
      document.getElementById('editPemenangLombaIndex').value = index;
      document.getElementById('editJuara1').value = lomba.pemenang ? lomba.pemenang.juara1 || '' : '';
      document.getElementById('editJuara2').value = lomba.pemenang ? lomba.pemenang.juara2 || '' : '';
      document.getElementById('editJuara3').value = lomba.pemenang ? lomba.pemenang.juara3 || '' : '';
    }

    async function savePemenangChanges() {
      const index = parseInt(document.getElementById('editPemenangLombaIndex').value);
      if (isNaN(index) || index < 0 || index >= lombaData.length) {
        console.error("Indeks lomba tidak valid.");
        return;
      }

      if (!lombaData[index].pemenang) {
          lombaData[index].pemenang = {}; // Inisialisasi jika belum ada
      }
      lombaData[index].pemenang.juara1 = document.getElementById('editJuara1').value;
      lombaData[index].pemenang.juara2 = document.getElementById('editJuara2').value;
      lombaData[index].pemenang.juara3 = document.getElementById('editJuara3').value;

      try {
          // Simpan pemenang ke Firestore
          await updateDoc(doc(db, `artifacts/${appId}/public/data/lomba`, lombaData[index].id), { pemenang: lombaData[index].pemenang });
          alert("Perubahan pemenang berhasil disimpan secara permanen!");
      } catch (error) {
          console.error("Error saving pemenang changes to Firestore:", error);
          alert("Gagal menyimpan perubahan pemenang ke database. Cek konsol untuk detail.");
      }

      // Perbarui tampilan modal pemenang jika sedang terbuka untuk lomba ini
      const currentModalLombaName = document.getElementById('judulPemenang').innerText.replace('üèÜ Pemenang ', '');
      if (currentModalLombaName === lombaData[index].nama) {
          showPemenang(lombaData[index].nama); // Panggil ulang untuk memperbarui tampilan
      }
      populateLeaderboard(); // Perbarui leaderboard setelah pemenang diubah
    }

    // Fungsi inisialisasi aplikasi utama
    async function initApp() {
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // PASTIKAN Firebase Authentication diaktifkan di konsol Firebase Anda!
            // Metode login anonim atau dengan token awal
            if (initialAuthToken) {
                await signInWithCustomToken(auth, initialAuthToken);
            } else {
                await signInAnonymously(auth);
            }

            // Dapatkan userId setelah autentikasi
            userId = auth.currentUser?.uid || crypto.randomUUID();
            console.log("User ID Firebase:", userId); // LOGGING USER ID

            // Coba ambil data lomba dari Firestore
            const lombaCollectionRef = collection(db, `artifacts/${appId}/public/data/lomba`);
            const lombaSnapshot = await getDocs(lombaCollectionRef);

            if (!lombaSnapshot.empty) {
                lombaData = []; // Kosongkan data lokal jika ada data di Firestore
                lombaSnapshot.forEach(doc => {
                    lombaData.push({ id: doc.id, ...doc.data() });
                });
                lombaData = parseLombaDates(lombaData); // Parse tanggal setelah data dimuat
                console.log("Data lomba dimuat dari Firestore. Jumlah lomba:", lombaData.length); // LOGGING: Jumlah lomba
            } else {
                // Jika Firestore kosong, inisialisasi dengan data lokal dan unggah ke Firestore
                console.log("Firestore kosong, menggunakan data lokal dan mengunggahnya.");
                lombaData = parseLombaDates(lombaData); // Pastikan data lokal juga diparse tanggalnya
                for (const lomba of lombaData) {
                    // Pastikan id lomba unik untuk Firestore
                    // Hapus dateObject sebelum menyimpan karena Date object tidak bisa langsung disimpan di Firestore
                    const { dateObject, ...lombaToSave } = lomba;
                    await setDoc(doc(db, `artifacts/${appId}/public/data/lomba`, lombaToSave.id), lombaToSave);
                }
                console.log("Data awal diunggah ke Firestore. Jumlah lomba:", lombaData.length); // LOGGING: Jumlah lomba
            }

            // Render awal semua lomba dengan pengurutan default (terlama ke terbaru)
            sortLomba('asc', lombaData);
            populateLeaderboard(); // Isi leaderboard

        } catch (error) {
            console.error("Error initializing Firebase or fetching data:", error);
            // Fallback ke data lokal jika ada masalah Firebase
            lombaData = [
              { id: 'lomba1', nama: "Memasukkan Pensil", kategori: "TK - SD kelas 3, SD kelas 4 - SMP", lokasi: "Lapangan Voli", tanggal: "2 Agustus 2025", konsep: "Sama seperti tahun sebelumnya", pemenang: {juara1: 'Budi', juara2: 'Santi', juara3: 'Agus'} },
              { id: 'lomba2', nama: "Mewarnai", kategori: "PAUD - SD kelas 3", lokasi: "Rumah Bpk Purwanto", tanggal: "2 Agustus 2025", konsep: "Gambar dari Kak Siska", pemenang: {juara1: 'Citra', juara2: 'Dedi', juara3: 'Eka'} },
              { id: 'lomba3', nama: "CCA (Cerdas Cermat Agama)", kategori: "SD kelas 4 - SMA", lokasi: "Rumah Bpk Purwanto", tanggal: "2 Agustus 2025", konsep: "Wajib bersuara saat menjawab", pemenang: {juara1: 'Fajar', juara2: 'Gita', juara3: 'Hadi'} },
              { id: 'lomba4', nama: "Lari Kelereng", kategori: "SD, SMP-SMA", lokasi: "Lapangan Voli", tanggal: "2 Agustus 2025", konsep: "Sama seperti tahun sebelumnya", pemenang: {juara1: 'Indra', juara2: 'Joko', juara3: 'Kartika'} },
              { id: 'lomba5', nama: "Lari Bendera", kategori: "SD kelas 3", lokasi: "Lapangan Voli", tanggal: "2 Agustus 2025", konsep: "Sama seperti tahun sebelumnya", pemenang: {juara1: 'Lina', juara2: 'Mira', juara3: 'Nia'} },
              { id: 'lomba6', nama: "Joget Balon", kategori: "Ibu-ibu", lokasi: "Lapangan Voli", tanggal: "9 Agustus 2025", konsep: "Sama seperti tahun sebelumnya", pemenang: {juara1: 'Bu Ani', juara2: 'Bu Beta', juara3: 'Bu Citra'} },
              { id: 'lomba7', nama: "Estafet Sarung", kategori: "Ibu-ibu", lokasi: "Lapangan Voli", tanggal: "9 Agustus 2025", konsep: "Sama seperti tahun sebelumnya", pemenang: {juara1: 'Bu Dewi', juara2: 'Bu Ela', juara3: 'Bu Fani'} },
              { id: 'lomba8', nama: "Balap Karung", kategori: "SD, SMP-SMA", lokasi: "Lapangan Voli", tanggal: "9 Agustus 2025", konsep: "Sama seperti tahun sebelumnya", pemenang: {juara1: 'Gilang', juara2: 'Hasan', juara3: 'Irfan'} },
              { id: 'lomba9', nama: "Pecah Air", kategori: "TK - SD kelas 3, SD kelas 4 - SMP", lokasi: "Lapangan Voli", tanggal: "9 Agustus 2025", konsep: "Sama seperti tahun sebelumnya", pemenang: {juara1: 'Jihan', juara2: 'Kevin', juara3: 'Laras'} },
              { id: 'lomba10', nama: "Estafet Tepung", kategori: "SD kelas 4 - SMA", lokasi: "Lapangan Voli", tanggal: "9 Agustus 2025", konsep: "Menggunakan kartu remi", pemenang: {juara1: 'Maya', juara2: 'Nanda', juara3: 'Oscar'} },
              { id: 'lomba11', nama: "Estafet Air", kategori: "SD kelas 4 - SMA", lokasi: "Lapangan Voli", tanggal: "9 Agustus 2025", konsep: "Gelas plastik ditali di atas kepala", pemenang: {juara1: 'Putri', juara2: 'Rian', juara3: 'Sinta'} },
              { id: 'lomba12', nama: "Volly Campuran", kategori: "Campuran Warga", lokasi: "Lapangan Voli", tanggal: "10 Agustus 2025", konsep: "4 Tim warga, sistem gugur, semifinal dan final, max 2 orang per KK", pemenang: {juara1: 'Tim A', juara2: 'Tim B', juara3: 'Tim C'} }
            ];
            sortLomba('asc', lombaData);
            populateLeaderboard();
            alert("Terjadi kesalahan saat memuat data. Menggunakan data lokal. Pastikan konfigurasi Firebase sudah benar dan aturan Firestore mengizinkan baca/tulis. Juga pastikan Firebase Authentication diaktifkan.");
        }
    }

    // Panggil initApp saat halaman dimuat
    window.onload = initApp;

</script>
<audio id="clapAudio" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_b8dd9f50a7.mp3?filename=short-applause.mp3" preload="auto"></audio>
</body>
</html>
